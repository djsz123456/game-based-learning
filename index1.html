<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家教时间记录助手</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Day.js -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <!-- FileSaver.js -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <style>
        /* 自定义样式 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: #24292e;
            background-color: #f6f8fa;
        }
        
        /* 头部样式 */
        .header {
            background-color: #ffffff;
            border-bottom: 1px solid #e1e4e8;
            padding: 1rem 0;
        }
        
        /* 功能区样式 */
        .action-bar {
            background-color: #ffffff;
            border-bottom: 1px solid #e1e4e8;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        /* 按钮样式 */
        .btn-primary {
            background-color: #2ea44f;
            border-color: #2ea44f;
        }
        
        .btn-primary:hover {
            background-color: #2c974b;
            border-color: #2c974b;
        }
        
        /* 表格样式 */
        .table {
            background-color: #ffffff;
            border: 1px solid #e1e4e8;
        }
        
        .table th {
            background-color: #f6f8fa;
            border-bottom: 2px solid #e1e4e8;
        }
        
        .table tbody tr:nth-child(even) {
            background-color: #f6f8fa;
        }
        
        /* 统计卡片样式 */
        .stat-card {
            background-color: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #24292e;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #586069;
        }
        
        /* 底部样式 */
        .footer {
            background-color: #f6f8fa;
            border-top: 1px solid #e1e4e8;
            padding: 1rem 0;
            margin-top: 2rem;
            font-size: 12px;
            color: #586069;
        }
        
        /* 弹窗样式 */
        .modal-content {
            border-radius: 6px;
        }
        
        /* 响应式适配 */
        @media (max-width: 768px) {
            .header-title {
                text-align: center;
            }
            
            .header-actions {
                text-align: center;
                margin-top: 0.5rem;
            }
            
            .filter-section {
                margin-top: 1rem;
            }
            
            .stat-card {
                text-align: center;
            }
        }
        
        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 3rem 0;
            color: #586069;
        }
        
        /* 提示消息样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }
    </style>
</head>
<body>
    <!-- 头部 -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 header-title">
                    <h1 class="h4 mb-0"><i class="fa fa-calendar-check-o mr-2"></i>家教时间记录助手</h1>
                </div>
                <div class="col-md-6 header-actions text-md-right">
                    <button id="loginBtn" class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">
                        <i class="fa fa-sign-in mr-1"></i>管理员登录
                    </button>
                    <button id="logoutBtn" class="btn btn-sm btn-outline-secondary me-2" style="display: none;">
                        <i class="fa fa-sign-out mr-1"></i>退出登录
                    </button>
                    <button id="helpBtn" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="fa fa-question-circle mr-1"></i>使用说明
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 核心功能区 -->
    <div class="container">
        <div class="action-bar">
            <div class="row align-items-center">
                <!-- 核心操作按钮 -->
                <div class="col-md-6">
                    <button id="addRecordBtn" class="btn btn-primary mr-2">
                        <i class="fa fa-plus mr-1"></i>新增记录
                    </button>
                    <button id="clearAllBtn" class="btn btn-outline-secondary mr-2">
                        <i class="fa fa-trash mr-1"></i>清空所有记录
                    </button>
                    <button id="exportBtn" class="btn btn-outline-secondary">
                        <i class="fa fa-download mr-1"></i>导出记录
                    </button>
                </div>
                
                <!-- 筛选功能 -->
                <div class="col-md-6 filter-section text-md-right">
                    <div class="d-inline-block mr-2">
                        <input type="text" id="studentFilter" class="form-control form-control-sm" placeholder="学生姓名">
                    </div>
                    <div class="d-inline-block mr-2">
                        <input type="date" id="startDateFilter" class="form-control form-control-sm">
                    </div>
                    <div class="d-inline-block mr-2">
                        <input type="date" id="endDateFilter" class="form-control form-control-sm">
                    </div>
                    <div class="d-inline-block">
                        <button id="weekFilterBtn" class="btn btn-sm btn-outline-secondary mr-1">本周</button>
                        <button id="monthFilterBtn" class="btn btn-sm btn-outline-secondary">本月</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 核心内容区 -->
        <div class="content-area">
            <!-- 记录列表 -->
            <div class="mb-4">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>学生姓名</th>
                            <th>授课日期</th>
                            <th>时间段</th>
                            <th>课时时长</th>
                            <th>内容摘要</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recordsTableBody">
                        <!-- 记录将通过 JavaScript 动态添加 -->
                    </tbody>
                </table>
                <div id="emptyState" class="empty-state">
                    <i class="fa fa-calendar-o fa-4x mb-3"></i>
                    <p>暂无记录，点击「新增记录」添加</p>
                </div>
            </div>

            <!-- 统计区 -->
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRecords">0</div>
                        <div class="stat-label">总记录数</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-number" id="totalHours">0.0</div>
                        <div class="stat-label">总课时时长</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-number" id="monthRecords">0</div>
                        <div class="stat-label">本月记录数</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-number" id="monthHours">0.0</div>
                        <div class="stat-label">本月课时时长</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部说明区 -->
    <footer class="footer">
        <div class="container text-center">
            <p class="mb-1">所有记录仅存储在您的浏览器本地（LocalStorage），清空浏览器数据会导致记录丢失，建议定期导出备份</p>
            <p class="mb-1">适配 GitHub Pages 静态部署 | 数据仅本地可见，无隐私泄露风险</p>
            <p>v1.0 | 最后更新：2026-01-29</p>
        </div>
    </footer>

    <!-- 新增/编辑记录弹窗 -->
    <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="recordModalLabel">新增记录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="recordForm">
                        <input type="hidden" id="recordId">
                        <div class="mb-3">
                            <label for="studentName" class="form-label">* 学生姓名</label>
                            <input type="text" class="form-control" id="studentName" required>
                        </div>
                        <div class="mb-3">
                            <label for="teachDate" class="form-label">* 授课日期</label>
                            <input type="date" class="form-control" id="teachDate" required>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="startTime" class="form-label">* 开始时间</label>
                                <input type="time" class="form-control" id="startTime" required>
                            </div>
                            <div class="col-md-6">
                                <label for="endTime" class="form-label">* 结束时间</label>
                                <input type="time" class="form-control" id="endTime" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="content" class="form-label">授课内容摘要</label>
                            <textarea class="form-control" id="content" rows="3" maxlength="50"></textarea>
                            <div class="form-text">最多50字</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">记录状态</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusCompleted" value="已完成" checked>
                                <label class="form-check-label" for="statusCompleted">已完成</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusPending" value="待确认">
                                <label class="form-check-label" for="statusPending">待确认</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" id="statusCancelled" value="已取消">
                                <label class="form-check-label" for="statusCancelled">已取消</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" id="saveRecordBtn" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 使用说明弹窗 -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">使用说明</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>功能说明</h6>
                    <ul>
                        <li><strong>新增记录</strong>：点击「新增记录」按钮，填写表单并保存</li>
                        <li><strong>编辑记录</strong>：点击记录列表中的「编辑」按钮，修改表单并保存</li>
                        <li><strong>删除记录</strong>：点击记录列表中的「删除」按钮，确认后删除</li>
                        <li><strong>筛选记录</strong>：通过学生姓名和日期范围进行筛选</li>
                        <li><strong>导出记录</strong>：点击「导出记录」按钮，选择导出格式（CSV或JSON）</li>
                        <li><strong>清空记录</strong>：点击「清空所有记录」按钮，确认后清空所有记录</li>
                    </ul>
                    <h6>数据存储</h6>
                    <p>所有记录均存储在您的浏览器本地（LocalStorage），请定期导出备份以防止数据丢失。</p>
                    <h6>注意事项</h6>
                    <ul>
                        <li>清空浏览器数据会导致记录丢失</li>
                        <li>删除记录后无法恢复</li>
                        <li>建议使用 Chrome、Firefox、Edge 等现代浏览器</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">我知道了</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导出格式选择弹窗 -->
    <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">导出记录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>请选择导出格式：</p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="exportFormat" id="exportCSV" value="csv" checked>
                        <label class="form-check-label" for="exportCSV">CSV 格式（可在 Excel 中打开）</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="exportFormat" id="exportJSON" value="json">
                        <label class="form-check-label" for="exportJSON">JSON 格式（适合程序处理）</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" id="confirmExportBtn" class="btn btn-primary">确认导出</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录弹窗 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">管理员登录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">用户名</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">密码</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" id="loginSubmitBtn" class="btn btn-primary">登录</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示消息 -->
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">提示</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            操作成功
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 初始化数据存储
        function initStorage() {
            if (!localStorage.getItem('tutoringRecords')) {
                localStorage.setItem('tutoringRecords', JSON.stringify([]));
            }
        }

        // 获取所有记录
        function getRecords() {
            return JSON.parse(localStorage.getItem('tutoringRecords') || '[]');
        }

        // 保存记录
        function saveRecords(records) {
            localStorage.setItem('tutoringRecords', JSON.stringify(records));
        }

        // 显示提示消息
        function showToast(message, duration = 3000) {
            const toast = document.querySelector('.toast');
            document.getElementById('toastMessage').textContent = message;
            const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toast);
            toastBootstrap.show();
            setTimeout(() => {
                toastBootstrap.hide();
            }, duration);
        }

        // 计算课时时长
        function calculateDuration(startTime, endTime) {
            const [startHour, startMinute] = startTime.split(':').map(Number);
            const [endHour, endMinute] = endTime.split(':').map(Number);
            const startTotalMinutes = startHour * 60 + startMinute;
            const endTotalMinutes = endHour * 60 + endMinute;
            const durationMinutes = endTotalMinutes - startTotalMinutes;
            return (durationMinutes / 60).toFixed(1);
        }

        // 渲染记录列表
        function renderRecords(records = null) {
            const recordsToRender = records || getRecords();
            const tableBody = document.getElementById('recordsTableBody');
            const emptyState = document.getElementById('emptyState');
            const isLoggedIn = checkLoginStatus();
            
            tableBody.innerHTML = '';
            
            if (recordsToRender.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                recordsToRender.forEach((record, index) => {
                    const row = document.createElement('tr');
                    // 根据登录状态决定是否显示操作按钮
                    const actionButtons = isLoggedIn ? `
                        <button class="btn btn-sm btn-outline-secondary edit-btn" data-id="${record.id}">
                            <i class="fa fa-pencil mr-1"></i>编辑
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${record.id}">
                            <i class="fa fa-trash mr-1"></i>删除
                        </button>
                    ` : '-';
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${record.studentName}</td>
                        <td>${record.teachDate}</td>
                        <td>${record.startTime} - ${record.endTime}</td>
                        <td>${record.duration}</td>
                        <td>${record.content || '-'}</td>
                        <td>${record.status}</td>
                        <td>${actionButtons}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // 绑定编辑和删除事件（仅当登录时）
                if (isLoggedIn) {
                    document.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', handleEditRecord);
                    });
                    
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', handleDeleteRecord);
                    });
                }
            }
            
            // 更新统计信息
            updateStatistics();
        }

        // 更新统计信息
        function updateStatistics() {
            const records = getRecords();
            const now = dayjs();
            const currentMonth = now.format('YYYY-MM');
            
            // 总记录数
            document.getElementById('totalRecords').textContent = records.length;
            
            // 总课时时长
            const totalHours = records.reduce((sum, record) => sum + parseFloat(record.duration), 0);
            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            
            // 本月记录数
            const monthRecords = records.filter(record => record.teachDate.startsWith(currentMonth)).length;
            document.getElementById('monthRecords').textContent = monthRecords;
            
            // 本月课时时长
            const monthHours = records
                .filter(record => record.teachDate.startsWith(currentMonth))
                .reduce((sum, record) => sum + parseFloat(record.duration), 0);
            document.getElementById('monthHours').textContent = monthHours.toFixed(1);
        }

        // 处理新增记录
        function handleAddRecord() {
            const modal = new bootstrap.Modal(document.getElementById('recordModal'));
            document.getElementById('recordModalLabel').textContent = '新增记录';
            document.getElementById('recordForm').reset();
            document.getElementById('recordId').value = '';
            document.getElementById('teachDate').value = dayjs().format('YYYY-MM-DD');
            modal.show();
        }

        // 处理编辑记录
        function handleEditRecord(e) {
            const id = e.currentTarget.getAttribute('data-id');
            const records = getRecords();
            const record = records.find(r => r.id === id);
            
            if (record) {
                const modal = new bootstrap.Modal(document.getElementById('recordModal'));
                document.getElementById('recordModalLabel').textContent = '编辑记录';
                document.getElementById('recordId').value = record.id;
                document.getElementById('studentName').value = record.studentName;
                document.getElementById('teachDate').value = record.teachDate;
                document.getElementById('startTime').value = record.startTime;
                document.getElementById('endTime').value = record.endTime;
                document.getElementById('content').value = record.content || '';
                
                // 设置状态
                document.querySelectorAll('input[name="status"]').forEach(radio => {
                    if (radio.value === record.status) {
                        radio.checked = true;
                    }
                });
                
                modal.show();
            }
        }

        // 处理保存记录
        function handleSaveRecord() {
            const id = document.getElementById('recordId').value;
            const studentName = document.getElementById('studentName').value;
            const teachDate = document.getElementById('teachDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const content = document.getElementById('content').value;
            const status = document.querySelector('input[name="status"]:checked').value;
            
            // 验证表单
            if (!studentName || !teachDate || !startTime || !endTime) {
                showToast('请填写必填字段');
                return;
            }
            
            // 验证时间
            if (startTime > endTime) {
                showToast('结束时间不能早于开始时间');
                return;
            }
            
            // 计算时长
            const duration = calculateDuration(startTime, endTime);
            
            const records = getRecords();
            
            if (id) {
                // 编辑现有记录
                const index = records.findIndex(r => r.id === id);
                if (index !== -1) {
                    records[index] = {
                        ...records[index],
                        studentName,
                        teachDate,
                        startTime,
                        endTime,
                        duration,
                        content,
                        status
                    };
                    saveRecords(records);
                    showToast('保存成功');
                }
            } else {
                // 新增记录
                const newRecord = {
                    id: Date.now().toString(),
                    studentName,
                    teachDate,
                    startTime,
                    endTime,
                    duration,
                    content,
                    status,
                    createdAt: new Date().toISOString()
                };
                records.push(newRecord);
                saveRecords(records);
                showToast('保存成功');
            }
            
            // 关闭弹窗并刷新列表
            const modal = bootstrap.Modal.getInstance(document.getElementById('recordModal'));
            modal.hide();
            renderRecords();
        }

        // 处理删除记录
        function handleDeleteRecord(e) {
            const id = e.currentTarget.getAttribute('data-id');
            
            if (confirm('确定要删除这条记录吗？删除后无法恢复。')) {
                const records = getRecords();
                const filteredRecords = records.filter(r => r.id !== id);
                saveRecords(filteredRecords);
                showToast('删除成功');
                renderRecords();
            }
        }

        // 处理清空所有记录
        function handleClearAll() {
            if (confirm('确定要清空所有记录吗？清空后无法恢复。')) {
                localStorage.removeItem('tutoringRecords');
                initStorage();
                showToast('清空成功');
                renderRecords();
            }
        }

        // 处理导出记录
        function handleExport() {
            const modal = new bootstrap.Modal(document.getElementById('exportModal'));
            modal.show();
        }

        // 处理确认导出
        function handleConfirmExport() {
            const format = document.querySelector('input[name="exportFormat"]:checked').value;
            const records = getRecords();
            
            if (records.length === 0) {
                showToast('暂无记录可导出');
                return;
            }
            
            if (format === 'csv') {
                // 导出为 CSV
                const headers = ['学生姓名', '授课日期', '开始时间', '结束时间', '课时时长', '内容摘要', '状态'];
                const csvContent = [
                    headers.join(','),
                    ...records.map(record => [
                        record.studentName,
                        record.teachDate,
                        record.startTime,
                        record.endTime,
                        record.duration,
                        `"${record.content || ''}"`,
                        record.status
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                saveAs(blob, '家教时间记录.csv');
            } else if (format === 'json') {
                // 导出为 JSON
                const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json;charset=utf-8;' });
                saveAs(blob, '家教时间记录.json');
            }
            
            showToast('导出成功');
            const modal = bootstrap.Modal.getInstance(document.getElementById('exportModal'));
            modal.hide();
        }

        // 处理筛选
        function handleFilter() {
            const studentFilter = document.getElementById('studentFilter').value.toLowerCase();
            const startDateFilter = document.getElementById('startDateFilter').value;
            const endDateFilter = document.getElementById('endDateFilter').value;
            
            const records = getRecords();
            const filteredRecords = records.filter(record => {
                // 学生姓名筛选
                const matchesStudent = !studentFilter || record.studentName.toLowerCase().includes(studentFilter);
                
                // 日期筛选
                const matchesDate = (!startDateFilter || record.teachDate >= startDateFilter) &&
                                   (!endDateFilter || record.teachDate <= endDateFilter);
                
                return matchesStudent && matchesDate;
            });
            
            renderRecords(filteredRecords);
        }

        // 处理本周筛选
        function handleWeekFilter() {
            const now = dayjs();
            const startOfWeek = now.startOf('week').format('YYYY-MM-DD');
            const endOfWeek = now.endOf('week').format('YYYY-MM-DD');
            
            document.getElementById('startDateFilter').value = startOfWeek;
            document.getElementById('endDateFilter').value = endOfWeek;
            handleFilter();
        }

        // 处理本月筛选
        function handleMonthFilter() {
            const now = dayjs();
            const startOfMonth = now.startOf('month').format('YYYY-MM-DD');
            const endOfMonth = now.endOf('month').format('YYYY-MM-DD');
            
            document.getElementById('startDateFilter').value = startOfMonth;
            document.getElementById('endDateFilter').value = endOfMonth;
            handleFilter();
        }

        // 管理员账号信息
        const ADMIN_USERNAME = 'djsz@admin';
        const ADMIN_PASSWORD = 'user@admin123456';

        // 检查登录状态
        function checkLoginStatus() {
            return localStorage.getItem('isAdminLoggedIn') === 'true';
        }

        // 处理登录
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                localStorage.setItem('isAdminLoggedIn', 'true');
                showToast('登录成功');
                updateUIForLoginStatus(true);
                const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                modal.hide();
            } else {
                showToast('用户名或密码错误');
            }
        }

        // 处理退出登录
        function handleLogout() {
            localStorage.removeItem('isAdminLoggedIn');
            showToast('已退出登录');
            updateUIForLoginStatus(false);
        }

        // 根据登录状态更新 UI
        function updateUIForLoginStatus(isLoggedIn) {
            // 更新登录/退出按钮
            document.getElementById('loginBtn').style.display = isLoggedIn ? 'none' : 'inline-block';
            document.getElementById('logoutBtn').style.display = isLoggedIn ? 'inline-block' : 'none';

            // 更新操作按钮状态
            const actionButtons = ['addRecordBtn', 'clearAllBtn'];
            actionButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = !isLoggedIn;
                    btn.classList.toggle('opacity-50', !isLoggedIn);
                }
            });

            // 重新渲染记录列表，更新操作按钮
            renderRecords();
        }

        // 初始化
        function init() {
            // 初始化存储
            initStorage();
            
            // 检查登录状态并更新 UI
            const isLoggedIn = checkLoginStatus();
            updateUIForLoginStatus(isLoggedIn);
            
            // 渲染记录列表
            renderRecords();
            
            // 绑定事件
            document.getElementById('addRecordBtn').addEventListener('click', handleAddRecord);
            document.getElementById('saveRecordBtn').addEventListener('click', handleSaveRecord);
            document.getElementById('clearAllBtn').addEventListener('click', handleClearAll);
            document.getElementById('exportBtn').addEventListener('click', handleExport);
            document.getElementById('confirmExportBtn').addEventListener('click', handleConfirmExport);
            document.getElementById('loginSubmitBtn').addEventListener('click', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // 筛选事件
            document.getElementById('studentFilter').addEventListener('input', handleFilter);
            document.getElementById('startDateFilter').addEventListener('change', handleFilter);
            document.getElementById('endDateFilter').addEventListener('change', handleFilter);
            document.getElementById('weekFilterBtn').addEventListener('click', handleWeekFilter);
            document.getElementById('monthFilterBtn').addEventListener('click', handleMonthFilter);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>